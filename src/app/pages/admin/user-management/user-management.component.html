<nz-spin [nzSize]="'large'" [nzSpinning]="isSpinning" [nzDelay]="0">
  <div class="h-full w-full">
    <div class="ant-card w-full">
      <div class="ant-card-body">
        <div class="kttk-search-form">
          <div class="ant-card w-full border-1 border-black">
            <div style="border: 1px solid #1890ff; padding-bottom: 0 !important; padding-top: 24px"
                 class="ant-card-body flex flex-col justify-center justify-items-center content-center rounded-md">
              <form nz-form [formGroup]="formSearch" class="ant-advanced-search-form">
                <div nz-row [nzGutter]="24">
                  <div nz-col [nzSpan]="8">
                    <nz-form-item>
                      <nz-form-label [nzFor]="'field1'">Tên đăng nhập</nz-form-label>
                      <nz-form-control>
                        <input
                          nz-input
                          placeholder="Tìm theo tên đăng nhập"
                        />
                      </nz-form-control>
                    </nz-form-item>
                  </div>
                  <div nz-col [nzSpan]="8">
                    <nz-form-item>
                      <nz-form-label [nzFor]="'field2'">Quyền</nz-form-label>
                      <nz-form-control>
                        <input
                          nz-input
                          placeholder="Tìm theo quyền"
                        />
                      </nz-form-control>
                    </nz-form-item>
                  </div>
                  <div nz-col [nzSpan]="8" class="search-area">
                    <button class="rounded" nz-button [nzType]="'primary'">Tìm kiếm</button>
                    <button class="rounded" nz-button (click)="resetForm()">Làm mới</button>
                    <button class="rounded" nz-button [nzType]="'primary'" (click)="toggleCollapse()">
                      Thêm
                      <i nz-icon [nzType]="isCollapse ? 'down' : 'up'"></i>
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </div>

        </div>
        <div class="kttk-operator mt-1 mb-1">
          <div class="nz-row">
            <button class="rounded align-middle" nz-button nzType="primary" (click)="showModal1()">
              <i nz-icon nzType="plus"></i>
              Thêm mới
            </button>
            <button class="rounded align-middle" nz-button nzType="primary" nzDanger (click)="showDeleteConfirm()"
                    [disabled]="setOfCheckedId.size == 0">
              <i nz-icon nzType="delete"></i>
              Xoá
            </button>
          </div>
        </div>
        <div class="kttk-table-list">
          <nz-table
            #rowSelectionTable
            nzShowSizeChanger
            [nzData]="listOfData"
            (nzCurrentPageDataChange)="onCurrentPageDataChange($event)"
          >
            <thead>
            <tr>
              <th
                [nzSelections]="listOfSelection"
                [(nzChecked)]="checked"
                [nzIndeterminate]="indeterminate"
                (nzCheckedChange)="onAllChecked($event)"
              ></th>
              <th>Username</th>
              <th>Full name</th>
              <th>Email</th>
              <th>Phone</th>
              <th>Quyền</th>
              <th>Action</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let data of rowSelectionTable.data">
              <td [nzChecked]="setOfCheckedId.has(data.id)" (nzCheckedChange)="onItemChecked(data.id, $event)"></td>
              <td>{{ data.username }}</td>
              <td>{{ data.fullName }}</td>
              <td>{{ data.email }}</td>
              <td>{{ data.phone }}</td>
              <td>{{ toListRoleName(data.roles) }}</td>
              <td>
                <button class="rounded btn-edit" nz-button [nzType]="'default'">Sửa</button>
              </td>
            </tr>
            </tbody>
          </nz-table>
        </div>
      </div>
    </div>
    <nz-modal [nzMaskClosable]="false" [nzWidth]="'50%'" [(nzVisible)]="isVisible" nzTitle="Thêm mới người dùng"
              (nzOnCancel)="handleCancel()">
      <div *nzModalContent>
        <form nz-form [formGroup]="formCreate" (ngSubmit)="submitForm()">
          <nz-form-item>
            <nz-form-label [nzSpan]="5" nzRequired nzFor="username_insert">Tên đăng nhập</nz-form-label>
            <nz-form-control [nzSpan]="12" nzErrorTip="Nhập tên đăng nhập!">
              <input id="username_insert" formControlName="username_insert" type="text" nz-input
                     placeholder="Nhập tên đăng nhập"/>
            </nz-form-control>
          </nz-form-item>
          <nz-form-item>
            <nz-form-label [nzSpan]="5" nzFor="role_insert" nzRequired>Quyền</nz-form-label>
            <nz-form-control [nzSpan]="12" nzErrorTip="Chọn quyền!">
              <nz-select
                id="role_insert"
                formControlName="role_insert"
                nzPlaceHolder="Chọn quyền!"
                nzMode="multiple">
                <nz-option *ngFor="let roleItem of listOfRole" [nzValue]="roleItem.id"
                           [nzLabel]="roleItem.name"></nz-option>
              </nz-select>
            </nz-form-control>
          </nz-form-item>
          <nz-form-item>
            <nz-form-label [nzSpan]="5" nzRequired nzFor="password_insert">Mật khẩu</nz-form-label>
            <nz-form-control [nzSpan]="12" nzErrorTip="Nhập mật khẩu!">
              <nz-input-group [nzSuffix]="suffixTemplate">
                <input
                  id="password_insert"
                  formControlName="password_insert"
                  [type]="passwordVisible ? 'text' : 'password'"
                  nz-input
                  placeholder="Nhập mật khẩu"
                />
              </nz-input-group>
              <ng-template #suffixTemplate>
                <i nz-icon [nzType]="passwordVisible ? 'eye-invisible' : 'eye'"
                   (click)="passwordVisible = !passwordVisible"></i>
              </ng-template>
            </nz-form-control>
          </nz-form-item>
          <nz-form-item>
            <nz-form-label [nzSpan]="5" nzRequired nzFor="email_insert">Email</nz-form-label>
            <nz-form-control [nzSpan]="12" nzErrorTip="Nhập email!">
              <input id="email_insert" formControlName="email_insert" type="email" nz-input placeholder="Nhập email"/>
            </nz-form-control>
          </nz-form-item>
        </form>
      </div>
      <div *nzModalFooter>
        <button nz-button nzType="default" nzDanger (click)="handleCancel()" [disabled]="isSaving">Huỷ</button>
        <button nz-button nzType="primary" [disabled]="!formCreate.valid" (click)="handleOk()"
                [nzLoading]="isConfirmLoading">Lưu
        </button>
      </div>
    </nz-modal>
  </div>
</nz-spin>
